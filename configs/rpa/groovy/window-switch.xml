<?xml version="1.0" encoding="UTF-8"?>
<config xmlns="http://web-harvest.sourceforge.net/schema/1.0/config" scriptlang="groovy">
    <selenium-flow>
    	<capability name="SEARCH_ALL_WINDOWS" value="true"/>
        <selenium name="seleniumDriver" browser="chrome" close-on-completion="true" start-in-private="true">
            <script><![CDATA[
       			import java.util.concurrent.TimeUnit; 
 				
 				TUS = TimeUnit.SECONDS;
 
                driver = seleniumDriver.getWrappedObject();
                driver.manage().timeouts().implicitlyWait(1, TimeUnit.MINUTES).pageLoadTimeout(1, TimeUnit.MINUTES);                
				
				driver.get("http://toolsqa.com/automation-practice-switch-windows/");
 				// save win parrent handle
				parentHandle	= driver.getWindowHandle();
 				TUS.sleep(2);
				// Click on the Button "New Message Window" 
				driver.findElement(By.xpath("//button[contains(.,'New Message Window')]")).click();
 				TUS.sleep(2);
 				// Click on the Button "New Browser Window" 
 				driver.findElement(By.xpath("//button[contains(.,'New Browser Window')]")).click(); 		
 				TUS.sleep(2);
 				
 				driver.switchTo().window(parentHandle);

				def handles = driver.getWindowHandles();
				while (handles.size()>1) {
					switchBetweenWindows(driver, parentHandle, handles);
					handles = driver.getWindowHandles();
				}
				
				driver.switchTo().window(parentHandle);
				TUS.sleep(3);
				
				public void switchBetweenWindows(WebDriver driver, String parentHandle, LinkedHashSet handles) {
					handles.each {
						if(!it.equals(parentHandle)) {
							driver.switchTo().window(it);
							TUS.sleep(3);
							driver.close();
							return false;
						}
					}
				}
            ]]></script>
        </selenium>
    </selenium-flow>
    
    <export include-original-data="true"></export>
</config>