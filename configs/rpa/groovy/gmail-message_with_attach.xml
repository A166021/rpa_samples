<?xml version="1.0" encoding="UTF-8"?>
<!-- {{
For this example need file with input data.

File format *.csv

loginPage - email URL (http://mail.google.com)
username - email (test@gmail.com)
receiver - email (test@gmail.com)
password - password to the enter
mailSubject - text (message subject)
mailBody - text (message content)
targetFilePath - file URL on the web (https://s3.amazonaws.com/wf.sharebox/examples/pdf-sample.pdf) 

 -->
<config xmlns="http://web-harvest.sourceforge.net/schema/1.0/config" scriptlang="groovy">
	<selenium-flow>
		<!-- {{ saving file from web to the RPA machine local temp and remember his name (autoit driver) -->
		<selenium name="autoitDriver" browser="autoit" close-on-completion="true">
			<script> <![CDATA[
				driver = autoitDriver.getWrappedObject();
				
				// Copy the file to the RPA machine.
				def localFilePath = (String) driver.executeScript(
						"String extension = \".\" + org.apache.commons.io.FilenameUtils.getExtension(\"" + targetFilePath + "\");\n" +
                        "File tmpFile = File.createTempFile(\"data-\", extension);\n" +
                        "org.apache.commons.io.FileUtils.copyURLToFile(new URL(\"" + targetFilePath + "\"), tmpFile);\n" +
                        "return tmpFile.getAbsolutePath();"
				, "GROOVY");
				
				// define sys variable fo local file path
				sys.defineVariable("localFilePath", localFilePath);
			]]></script>
		</selenium>
		<!-- }} saving file from web to the RPA machine local temp and remember his name (autoit driver) -->
    
		<!-- {{ login to the e-mail and make new message -->
		<selenium name="seleniumDriver" browser="internet explorer" close-on-completion="false" start-in-private="true">
            <script><![CDATA[
            	import java.util.concurrent.TimeUnit; 
            
                ieDriver = seleniumDriver.getWrappedObject();
                ieDriver.manage().timeouts().implicitlyWait(1, TimeUnit.MINUTES).pageLoadTimeout(1, TimeUnit.MINUTES);

				// get mail login page
                ieDriver.get(loginPage.toString());
			
				// set account login
				email = ieDriver.findElement(By.id("Email"));
				email.click();
				email.sendKeys(username.toString());
				
				// go to the next page for set password
				ieDriver.findElement(By.id("next")).click();    
				
				// set account password
				passwd = ieDriver.findElement(By.id("Passwd"));
				passwd.click();  
				passwd.sendKeys(password.toString());
				
				// enter to the mail
				ieDriver.findElement(By.id("signIn")).click();

				// creating new message
				ieDriver.findElement(By.xpath("//div[text()='COMPOSE']")).click();
				
				// set message destination
				toElement = ieDriver.findElement(By.xpath("//textarea[@aria-label='To']"));
				toElement.click();
				toElement.sendKeys(receiver.toString());
				
				// set message subject
				subjectElement = ieDriver.findElement(By.name("subjectbox"));
				subjectElement.click();
				subjectElement.sendKeys(mailSubject.toString());
				
				// set message text
				msgBodyElement = ieDriver.findElement(By.xpath("//div[@aria-label = 'Message Body']"));	
				msgBodyElement.click();
				msgBodyElement.sendKeys(mailBody.toString());

				// Start attaching file.
				msgAttacheElement = ieDriver.findElement(By.xpath("//div[@class='a1 aaA aMZ']"));
				msgAttacheElement.click();
            ]]></script>
        </selenium>
        <!-- }} login to the e-mail and make new message -->
		
		<!-- {{ attaching file to the message from the RPA machine local temp (autoit driver)-->
		<selenium name="autoitDriver" browser="autoit" close-on-completion="false">
			<script><![CDATA[
				driver = autoitDriver.getWrappedObject();
				// Attach file using "upload file" dialog.
				driver.switchTo().window("[CLASS:#32770;TITLE:Choose File to Upload]");
				driver.findElement(By.cssSelector("[CLASS:Edit;INSTANCE:1]")).sendKeys(localFilePath.getWrappedObject());
				driver.findElement(By.cssSelector("[CLASS:Button;INSTANCE:1]")).click();
 			]]></script>
		</selenium>
		<!-- }} attaching file to the message from the RPA machine local temp (autoit driver)-->
		
		<!-- {{ send message -->
		<selenium name="seleniumDriver" browser="internet explorer" close-on-completion="true">
			<script><![CDATA[
				ieDriver = seleniumDriver.getWrappedObject();
				// Send the message.
				ieDriver.findElement(By.xpath("//div[text() = 'Send']")).click();
 			]]></script>
		</selenium>
		<!-- }} send message -->
		
		<!-- {{ login to the e-mail for viewing recieved message -->
		<selenium name="seleniumDriver" browser="internet explorer" close-on-completion="true" start-in-private="true">
            <script><![CDATA[
            	import java.util.concurrent.TimeUnit; 
            
                ieDriver = seleniumDriver.getWrappedObject();
                
                ieDriver.manage().timeouts().implicitlyWait(1, TimeUnit.MINUTES).pageLoadTimeout(1, TimeUnit.MINUTES);

                ieDriver.get(loginPage.toString());
			
				// Login into the mail system.
				email = ieDriver.findElement(By.id("Email"));
				email.click();
				email.sendKeys(username.toString());
				
				ieDriver.findElement(By.id("next")).click();    
				
				passwd = ieDriver.findElement(By.id("Passwd"));
				passwd.click();  
				passwd.sendKeys(password.toString());
				
				ieDriver.findElement(By.id("signIn")).click();
				
				// 20 seconds timeout for viewing
				TimeUnit.SECONDS.sleep(30);
			]]></script>
		</selenium>		
		<!-- }} login to the e-mail for viewing recieved message -->
    </selenium-flow>
       
	<!-- {{ Exporting file path from the RPA machine local temp -->
	<export include-original-data="false">    
 		<single-column name="rpa_local_file_path" value="${localFilePath}"/>
	</export>
	<!-- }} Exporting file path from the RPA machine local temp -->
</config>	