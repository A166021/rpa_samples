<?xml version="1.0" encoding="UTF-8"?>
<config xmlns="http://web-harvest.sourceforge.net/schema/1.0/config" scriptlang="groovy">
    <selenium-flow>
        <selenium name="autoitDriver" browser="autoit" close-on-completion="false">
            <script><![CDATA[
            	// {{ import library
       			import java.util.concurrent.TimeUnit;
       			import org.openqa.selenium.Keys;
       			import org.openqa.selenium.support.ui.*; 
 				// }} import library
 				
 				// {{ define some text for inserting to the notepad doc
 				def someText = 
 				"This is a new content which is added by \"RPA agent\".\n"+
 				"\n"+
 				"additional string for demo text\n";
 				// }} define some text for inserting to the notepad doc
 				// define save path for notepad doc
 				def savePath = "c:\\WFS_Work\\testNotepad.txt";
 				// map TimeUnit.SECONDS
 				TUS = TimeUnit.SECONDS;
 				// get and setup Autoit driver
                aDriver = autoitDriver.getWrappedObject();
                aDriver.manage().timeouts().implicitlyWait(1, TimeUnit.MINUTES);                
				// Open notepad
				aDriver.get("notepad.exe");
				// switch to notepad window
				aDriver.switchTo().window("[CLASS:Notepad]");
				// sleep for view
				TUS.sleep(1);
				// {{ clear edit text window and set text
				editField = aDriver.findElement(By.cssSelector("[CLASS:Edit; INSTANCE:1]"));
				editField.clear();
				editField.click();
				editField.sendKeys(someText);
				// }} clear edit text window and set text
				// sleep for view
				TUS.sleep(2);
				// {{ call save file dialogue
				Actions ctrlS = new Actions(aDriver);
				ctrlS.sendKeys(Keys.chord(Keys.CONTROL,"s")).perform();
				// }} call save file dialogue
				// switch to 'save as' window
				aDriver.switchTo().window("[CLASS:#32770; TITLE:Save As]");
				// {{ set save path
				pathField = aDriver.findElement(By.cssSelector("[CLASS:Edit; INSTANCE:1]"));
				pathField.clear();
				pathField.click();
				pathField.sendKeys(savePath);
				// }} set save path
				// {{ press "Save" button
				saveButton = aDriver.findElement(By.cssSelector("[CLASS:Button; INSTANCE:2]"));
				saveButton.click();
				// }} press "Save" button
				// {{ if we have file in this directory confirm "save"
				if(aDriver.getWindowHandles().size()>2) {
					aDriver.switchTo().window("[CLASS:#32770; TITLE:Confirm Save As]");
					replaceDialogue = aDriver.findElement(By.cssSelector("[CLASS:Button; INSTANCE:1]"));
					replaceDialogue.click();
				}
				// }} if we have file in this directory confirm "save"
				// {{ switch to notepad window and close it
				aDriver.switchTo().window("[CLASS:Notepad]");
				TUS.sleep(2);
				aDriver.close();
 				// }} switch to notepad window and close it
 				// return save path to sys values
 				sys.defineVariable("savePath", savePath)
            ]]></script>
        </selenium>
    </selenium-flow>

	<!-- Export values -->
    <export include-original-data="false">
		<single-column name="file_path" value="${savePath}" />
    </export>
	
</config>